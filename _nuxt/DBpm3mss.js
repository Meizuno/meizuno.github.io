import{Y as J,z as K,ay as P,az as N,J as W,r as u,c7 as X,P as Q,b as Z,e as $,f,X as v,W as k,g as z,h as ee,F as te,E as A,bI as ae,bK as se,w as C,a7 as g,i as d,n as x,H as F,G as le,ar as oe,bh as re,a8 as O,ax as h}from"./r87NNr1M.js";import{u as I,f as ue}from"./CuerbVKd.js";import j from"./j7N0kxdo.js";import"./DuNahpxg.js";import"./CkL-Al-B.js";import"./Cfy4yC-k.js";import"./7cgco4TI.js";import"./CwZk1OUt.js";const ne={slots:{root:"w-full flex flex-col gap-1 flex-1 px-2.5 [&>article]:last-of-type:min-h-(--last-message-height)",indicator:"h-6 flex items-center gap-1 py-3 *:size-2 *:rounded-full *:bg-elevated [&>*:nth-child(1)]:animate-[bounce_1s_infinite] [&>*:nth-child(2)]:animate-[bounce_1s_0.15s_infinite] [&>*:nth-child(3)]:animate-[bounce_1s_0.3s_infinite]",viewport:"absolute inset-x-0 top-[86%] data-[state=open]:animate-[fade-in_200ms_ease-out] data-[state=closed]:animate-[fade-out_200ms_ease-in]",autoScroll:"rounded-full absolute right-1/2 translate-x-1/2 bottom-0"},variants:{compact:{true:"",false:""}}},ie=["data-status"],ce=["data-state"],ye={__name:"UChatMessages",props:{messages:{type:Array,required:!1},status:{type:String,required:!1},shouldAutoScroll:{type:Boolean,required:!1,default:!1},shouldScrollToBottom:{type:Boolean,required:!1,default:!0},autoScroll:{type:[Boolean,Object],required:!1,default:!0},autoScrollIcon:{type:null,required:!1},user:{type:Object,required:!1},assistant:{type:Object,required:!1},compact:{type:Boolean,required:!1},spacingOffset:{type:Number,required:!1,default:0},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(o){const l=o,L=J(),R=()=>se(L,["default","indicator","viewport"]),B=K(),V=P(()=>N(l.user,{side:"right",variant:"soft"})),M=P(()=>N(l.assistant,{side:"left",variant:"naked"})),n=W(()=>O({extend:O(ne),...B.ui?.chatMessages||{}})({compact:l.compact})),m=u(null),e=u(null),S=u(new Map),y=u(!1),q=u(0),H=u(!1),w=u(0),i=u(!1);function G(a,s){const t=s?.$el;t&&S.value.set(a,t)}function U(a){const s=S.value.get(a);s&&s.scrollIntoView({behavior:"smooth",block:"start"})}function b(a=!0){e.value&&(a?e.value.scrollTo({top:e.value.scrollHeight,behavior:"smooth"}):e.value.scrollTop=e.value.scrollHeight)}X([()=>l.messages,()=>l.status],([a,s])=>{if(s==="streaming"){if(!l.shouldAutoScroll){T();return}h(()=>{!e.value||i.value||e.value.scrollHeight-e.value.scrollTop-e.value.clientHeight<150&&b(!1)})}},{deep:!0,throttle:50,leading:!0}),Q(()=>l.status,a=>{if(a!=="submitted")return;const s=l.messages?.[l.messages.length-1];!s||s.role!=="user"||(i.value=!1,h(()=>{H.value=!0,E(),h(()=>{U(s.id)})}))});function T(){if(!e.value)return;const a=e.value.scrollTop+e.value.clientHeight,s=e.value.scrollHeight,t=100;y.value=s-a>=t,e.value.scrollTop<w.value?i.value=!0:s-a<t&&(i.value=!1),w.value=e.value.scrollTop}function _(){i.value=!1,b()}function Y(a){if(!a)return document.documentElement;const s=/auto|scroll/;let t=a;for(;t&&t!==document.body&&t!==document.documentElement;){const r=window.getComputedStyle(t);if(s.test(r.overflowY))return t;t=t.parentElement}return document.documentElement}function E(){if(!m.value||!e.value||!l.messages?.length||!H.value)return;const{height:a}=ue(e.value),s=l.messages.findLast(D=>D.role==="user");if(!s)return;const t=S.value.get(s.id);if(!t)return;let r=l.spacingOffset||0;const c=window.getComputedStyle(m.value),p=window.getComputedStyle(e.value);r+=Number.parseFloat(c.rowGap)||Number.parseFloat(c.gap)||0,r+=Number.parseFloat(p.paddingTop)||0,r+=Number.parseFloat(p.paddingBottom)||0,q.value=Math.max(a.value-t.offsetHeight-r,0)}return Z(()=>{e.value=Y(m.value),e.value&&(w.value=e.value.scrollTop,setTimeout(()=>{l.shouldScrollToBottom?b(!1):T()},100),I(e,"scroll",T),I(window,"resize",()=>h(E)))}),(a,s)=>(f(),$("div",{ref_key:"el",ref:m,"data-status":o.status,"data-slot":"root",class:x(n.value.root({class:[l.ui?.root,l.class]})),style:re({"--last-message-height":`${q.value}px`})},[v(a.$slots,"default",{},()=>[(f(!0),$(te,null,A(o.messages,t=>(f(),k(j,g({key:t.id},{ref_for:!0},{...t,...t.role==="user"?V.value:M.value},{ref_for:!0,ref:r=>G(t.id,r),compact:o.compact}),ae({_:2},[A(R(),(r,c)=>({name:c,fn:C(p=>[v(a.$slots,c,g({ref_for:!0},p,{message:t}))])}))]),1040,["compact"]))),128))]),o.status==="submitted"?(f(),k(j,g({key:0,id:"indicator",role:"assistant"},{...M.value,actions:void 0,parts:[]},{compact:o.compact}),{content:C(()=>[v(a.$slots,"indicator",{ui:n.value},()=>[d("div",{"data-slot":"indicator",class:x(n.value.indicator({class:l.ui?.indicator}))},[...s[0]||(s[0]=[d("span",null,null,-1),d("span",null,null,-1),d("span",null,null,-1)])],2)])]),_:3},16,["compact"])):z("",!0),ee(F(oe),{present:y.value},{default:C(()=>[d("div",{"data-state":y.value?"open":"closed","data-slot":"viewport",class:x(n.value.viewport({class:l.ui?.viewport}))},[v(a.$slots,"viewport",{ui:n.value,onClick:_},()=>[o.autoScroll?(f(),k(le,g({key:0,icon:o.autoScrollIcon||F(B).ui.icons.arrowDown,color:"neutral",variant:"outline"},typeof o.autoScroll=="object"?o.autoScroll:{},{"data-slot":"autoScroll",class:n.value.autoScroll({class:l.ui?.autoScroll}),onClick:_}),null,16,["icon","class"])):z("",!0)])],10,ce)]),_:3},8,["present"])],14,ie))}};export{ye as default};
