import{r as D,D as $,ae as Q,ai as Z,af as H,J as _,bi as ee,W as z,f as j,w as F,h as J,H as g,ab as U,an as B,aF as q,X as W,ax as te,am as M,ah as le,a7 as ae,bz as L}from"./BTXGmdcq.js";import{R as ne}from"./BU8tAcgU.js";import{u as re}from"./DvJmaCIR.js";import{f as P}from"./BzeTaDLP.js";import{u as ue}from"./Ch2MuIH6.js";import{M as ie}from"./uiXGz-MS.js";import{R as se}from"./DTLNqkyv.js";function de(r,v){const e=D(),o=(t,S)=>{if(v.multiple&&Array.isArray(r.value))if(v.selectionBehavior==="replace")r.value=[t],e.value=t;else{const h=r.value.findIndex(i=>S(i));h!==-1?r.value=r.value.filter((i,f)=>f!==h):r.value=[...r.value,t]}else v.selectionBehavior==="replace"?r.value={...t}:!Array.isArray(r.value)&&S(r.value)?r.value=void 0:r.value={...t};return r.value};function E(t,S,h,i){if(!e?.value||!v.multiple||!Array.isArray(r.value))return;const A=h().filter(C=>C.ref.dataset.disabled!=="").find(C=>C.ref===S)?.value;if(!A)return;let K=null;switch(t){case"prev":case"next":{K=P(i,e.value,A);break}case"first":{K=P(i,e.value,i?.[0]);break}case"last":{K=P(i,e.value,i?.[i.length-1]);break}}r.value=K}return{firstValue:e,onSelectItem:o,handleMultipleReplace:E}}function N(r){return r.reduce((v,e)=>(v.push(e),e.children&&v.push(...N(e.children)),v),[])}const[oe,ce]=Q("TreeRoot");var ve=$({__name:"TreeRoot",props:{modelValue:{type:null,required:!1},defaultValue:{type:null,required:!1},items:{type:Array,required:!1},expanded:{type:Array,required:!1},defaultExpanded:{type:Array,required:!1},getKey:{type:Function,required:!0},getChildren:{type:Function,required:!1,default:r=>r.children},selectionBehavior:{type:String,required:!1,default:"toggle"},multiple:{type:Boolean,required:!1,skipCheck:!0},dir:{type:String,required:!1},disabled:{type:Boolean,required:!1},propagateSelect:{type:Boolean,required:!1},bubbleSelect:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"ul"}},emits:["update:modelValue","update:expanded"],setup(r,{emit:v}){const e=r,o=v,{items:E,multiple:t,disabled:S,propagateSelect:h,dir:i,bubbleSelect:f}=Z(e),{handleTypeaheadSearch:A}=ue(),K=re(i),C=D(),k=D(!1),R=ee(),u=H(e,"modelValue",o,{defaultValue:e.defaultValue??(t.value?[]:void 0),passive:!0,deep:!0}),p=H(e,"expanded",o,{defaultValue:e.defaultExpanded??[],passive:e.expanded===void 0,deep:!0}),{onSelectItem:l,handleMultipleReplace:n}=de(u,e),s=_(()=>t.value&&Array.isArray(u.value)?u.value.map(a=>e.getKey(a)):[e.getKey(u.value??{})]);function I(a,d=1,y){return a.reduce((c,m,w)=>{const G=e.getKey(m),O=e.getChildren(m),X=p.value.includes(G),Y={_id:G,value:m,index:w,level:d,parentItem:y,hasChildren:!!O,bind:{value:m,level:d,"aria-setsize":a.length,"aria-posinset":w+1}};return c.push(Y),O&&X&&c.push(...I(O,d+1,m)),c},[])}const T=_(()=>{const a=e.items;return p.value.map(d=>d),I(a??[])});function x(a){if(k.value)R.trigger(a);else{const d=C.value?.getItems()??[];A(a.key,d)}}function b(a){if(k.value)return;const d=ie[a.key];te(()=>{n(d,M(),C.value?.getItems,T.value.map(y=>y.value))})}function V(a){if(a.parentItem!=null&&Array.isArray(u.value)&&e.multiple){const d=T.value.find(y=>a.parentItem!=null&&e.getKey(y.value)===e.getKey(a.parentItem));d!=null&&(e.getChildren(d.value)?.every(c=>u.value.find(m=>e.getKey(m)===e.getKey(c)))?u.value=[...u.value,d.value]:u.value=u.value.filter(c=>e.getKey(c)!==e.getKey(d.value)),V(d))}}return ce({modelValue:u,selectedKeys:s,onSelect:a=>{const d=c=>e.getKey(c??{})===e.getKey(a),y=e.multiple&&Array.isArray(u.value)?u.value?.findIndex(d)!==-1:void 0;if(l(a,d),e.bubbleSelect&&e.multiple&&Array.isArray(u.value)){const c=T.value.find(m=>e.getKey(m.value)===e.getKey(a));c!=null&&V(c)}if(e.propagateSelect&&e.multiple&&Array.isArray(u.value)){const c=N(e.getChildren(a)??[]);y?u.value=[...u.value].filter(m=>!c.some(w=>e.getKey(m??{})===e.getKey(w))):u.value=[...u.value,...c]}},expanded:p,onToggle(a){if(!(a?e.getChildren(a):void 0))return;const y=e.getKey(a)??a;p.value.includes(y)?p.value=p.value.filter(c=>c!==y):p.value.push(y)},getKey:e.getKey,getChildren:e.getChildren,items:E,expandedItems:T,disabled:S,multiple:t,dir:K,propagateSelect:h,bubbleSelect:f,isVirtual:k,virtualKeydownHook:R,handleMultipleReplace:n}),(a,d)=>(j(),z(g(se),{ref_key:"rovingFocusGroupRef",ref:C,"as-child":"",orientation:"vertical",dir:g(K)},{default:F(()=>[J(g(U),{role:"tree",as:a.as,"as-child":a.asChild,"aria-multiselectable":g(t)?!0:void 0,onKeydown:[x,B(q(b,["shift"]),["up","down"])]},{default:F(()=>[W(a.$slots,"default",{flattenItems:T.value,modelValue:g(u),expanded:g(p)})]),_:3},8,["as","as-child","aria-multiselectable","onKeydown"])]),_:3},8,["dir"]))}}),Ae=ve;const fe="tree.select",pe="tree.toggle";var ye=$({inheritAttrs:!1,__name:"TreeItem",props:{value:{type:null,required:!0},level:{type:Number,required:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"li"}},emits:["select","toggle"],setup(r,{expose:v,emit:e}){const o=r,E=e,t=oe(),{getItems:S}=le(),h=_(()=>!!t.getChildren(o.value)),i=_(()=>{const l=t.getKey(o.value);return t.expanded.value.includes(l)}),f=_(()=>{const l=t.getKey(o.value);return t.selectedKeys.value.includes(l)}),A=_(()=>{if(t.bubbleSelect.value&&h.value&&Array.isArray(t.modelValue.value)){const l=N(t.getChildren(o.value)||[]);return l.some(n=>t.modelValue.value.find(s=>t.getKey(s)===t.getKey(n)))&&!l.every(n=>t.modelValue.value.find(s=>t.getKey(s)===t.getKey(n)))}else return t.propagateSelect.value&&f.value&&h.value&&Array.isArray(t.modelValue.value)?!N(t.getChildren(o.value)||[]).every(n=>t.modelValue.value.find(s=>t.getKey(s)===t.getKey(n))):void 0});function K(l){if(h.value)if(i.value){const n=S().map(b=>b.ref),s=M(),I=n.indexOf(s),x=[...n].slice(I).find(b=>Number(b.getAttribute("data-indent"))===o.level+1);x&&x.focus()}else p(l)}function C(l){if(i.value)p(l);else{const n=S().map(b=>b.ref),s=M(),I=n.indexOf(s),x=[...n].slice(0,I).reverse().find(b=>Number(b.getAttribute("data-indent"))===o.level-1);x&&x.focus()}}async function k(l){E("select",l),!l?.defaultPrevented&&t.onSelect(o.value)}async function R(l){E("toggle",l),!l?.defaultPrevented&&t.onToggle(o.value)}async function u(l){if(!l)return;const n={originalEvent:l,value:o.value,isExpanded:i.value,isSelected:f.value};L(fe,k,n)}async function p(l){if(!l)return;const n={originalEvent:l,value:o.value,isExpanded:i.value,isSelected:f.value};L(pe,R,n)}return v({isExpanded:i,isSelected:f,isIndeterminate:A,handleToggle:()=>t.onToggle(o.value),handleSelect:()=>t.onSelect(o.value)}),(l,n)=>(j(),z(g(ne),{"as-child":"",value:l.value,"allow-shift-key":""},{default:F(()=>[J(g(U),ae(l.$attrs,{role:"treeitem",as:l.as,"as-child":l.asChild,"aria-selected":f.value,"aria-expanded":h.value?i.value:void 0,"aria-level":l.level,"data-indent":l.level,"data-selected":f.value?"":void 0,"data-expanded":i.value?"":void 0,onKeydown:[B(q(u,["self","prevent"]),["enter","space"]),n[0]||(n[0]=B(q(s=>g(t).dir.value==="ltr"?K(s):C(s),["prevent"]),["right"])),n[1]||(n[1]=B(q(s=>g(t).dir.value==="ltr"?C(s):K(s),["prevent"]),["left"]))],onClick:n[2]||(n[2]=q(s=>{u(s),p(s)},["stop"]))}),{default:F(()=>[W(l.$slots,"default",{isExpanded:i.value,isSelected:f.value,isIndeterminate:A.value,handleSelect:()=>g(t).onSelect(l.value),handleToggle:()=>g(t).onToggle(l.value)})]),_:3},16,["as","as-child","aria-selected","aria-expanded","aria-level","data-indent","data-selected","data-expanded","onKeydown"])]),_:3},8,["value"]))}}),Te=ye;export{Te as T,Ae as a,oe as i};
